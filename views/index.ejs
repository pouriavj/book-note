<%- include('partials/header.ejs'); -%>

  <div class="container">
    <% if (locals.success) { %>
      <div id="success-notification" class="alert alert-success alert-dismissible fade show my-2 mb-4" role="alert">
        <%= success %>
      </div>
      <% } %>

        <div class="row g-5">
          <div class="col-md-10">
            <div class="d-flex justify-content-between align-items-center pb-4 mb-4 border-bottom">
              <% if (locals.caption){ %>
    <h3 class="fst-italic mb-0"><%= caption %></h3>
  <% } %>
   <% if (locals.sortOption) {%>             
  <div class="dropdown" style="margin-left:auto;">
    
    <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="min-width:120px;">
      <%= sortOption %>
    </button>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="sortDropdown" style="min-width:120px;">
      <li><a class="dropdown-item" href="/rating">By Rating <i class="bi bi-star-fill"></i></a></li>
      <li><a class="dropdown-item" href="/date">By Date <i class="bi bi-calendar-event"></i></a></li>
    </ul>
  </div>
  <% } %>
            </div>

            <% if (locals.posts && locals.posts.length> 0) { %>
              <% posts.forEach(post=> { %>
                <div class="card mb-4">
                  <div class="row g-0 align-items-start">
                    <% if (post.cover) { %>
                      <div class="col-auto">
                        <img src="<%= post.cover %>" alt="Book Cover" class="img-fluid rounded-start"
                          style="max-height:200px;">
                      </div>
                      <% } else { %>
                        <div class="col-auto">
                          <img src="assets/icons/noCover.png" alt="Book Cover" class="img-fluid rounded-start"
                            style="max-height:210px;">
                        </div>
                        <% } %>
                          <div class="col">
                            <div class="card-body">
                              <h5 class="card-title mb-1">
                                <%= post.title %>
                              </h5>

                              <% if (post.author || post.created_at) { %>
                                <p class="text-muted small mb-2">
                                  <% if (post.author) { %>
                                    By <strong>
                                      <%= post.author %>
                                    </strong>
                                    <% } %>
                                      <% if (post.created_at) { %>
                                        • <%= post.created_at %>
                                          <% } %>
                                </p>
                                <% } %>

                                  <p class="card-text">
                                    <%= post.notes %>
                                  </p>
                                  <p class="card-text mb-0"><strong>Rating:</strong>
                                    <%= post.rating %> ⭐
                                  </p>

                                  <% if (post.username) { %>
                                    <p class="text-muted small mt-1">
                                      — Posted by <strong>
                                        <%= post.username %>
                                      </strong>
                                    </p>
                                    <% } %>

                            </div>
                          </div>
                  </div>
                </div>
                <% }) %>
                  <% } else { %>
                    <p class="text-muted">No posts available yet.</p>
                    <% } %>

          </div>

          <div class="col-md-2">
            <div class="position-sticky" style="top: 2rem">
              <div class="p-4">
                <h4 class="fst-italic">Collections</h4>
                <ol class="list-unstyled mb-0">
                  <li><a href="#">March 2021</a></li>
                  <li><a href="#">February 2021</a></li>
                  <li><a href="#">January 2021</a></li>
                  <li><a href="#">December 2020</a></li>
                  <li><a href="#">November 2020</a></li>
                  <li><a href="#">October 2020</a></li>
                  <li><a href="#">September 2020</a></li>
                  <li><a href="#">August 2020</a></li>
                  <li><a href="#">July 2020</a></li>
                  <li><a href="#">June 2020</a></li>
                  <li><a href="#">May 2020</a></li>
                  <li><a href="#">April 2020</a></li>
                </ol>
              </div>
            </div>
          </div>
        </div>
  </div>

  <script>
    const successDiv = document.getElementById('success-notification');
    if (successDiv) {
      setTimeout(() => {
        successDiv.classList.remove('show'); // fades out
        successDiv.classList.add('d-none');  // hides completely, no space
      }, 6000); // 6 seconds
    }
  </script>

  <%- include('partials/footer.ejs'); -%>